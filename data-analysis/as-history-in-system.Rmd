---
title: "Tracking architectural smells"
output: html_notebook
---

This notebook analyses the output of an architectural smell tracker and outputs some descriptive plots.

```{r include=FALSE}
library(dplyr)
library(ggplot2)
library(svDialogs)
project <- dlgInput("Project: ")$res
similarity_scores_file <- paste("../test-data/output/trackASOutput", project, "similarity-scores-consecOnly.csv", sep="/")
characteristics_file <- paste("../test-data/output/trackASOutput", project, "smell-characteristics-consecOnly.csv", sep="/")
df <- read.table(characteristics_file, header = T, sep = ",")
df <- df[!is.na(df$age),]
df.similarity <- read.table(similarity_scores_file, header = T, sep = ",")
```

##Number of smells per version
```{r}
p <- ggplot(df, aes(version, group = smellType, fill = smellType)) + geom_bar()
print(p)
```

##Ratio of smells linked to their predecessor
The number of smells in a certain version that are the evolution of a smell in the previous version
```{r}
df.count <- df %>% group_by(version, smellType) %>% tally()
df.similarity.count <- df.similarity %>% filter(matched == "true") %>% group_by(nextVersion, nextType) %>% tally()
m <- merge(df.count, df.similarity.count, by.x = c(1,2), by.y = c(1,2), all = T)
m[is.na(m)] <- 0
m$perc <- (m$n.y / m$n.x)/length(unique(m$smellType))
p <- ggplot(m, aes(x=version, y=perc, group=smellType, fill=smellType)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=n.x), position = "stack", size = 2)
print(p)
```


##Age distribution of smells
Here is the distribution for each type of smell and the mean age shown as a dashed blue vertical line.
```{r}
df.unique <-df[!duplicated(df$uniqueSmellID), c(1,2,3,5)]
p <- ggplot(df.unique, aes(age, group = smellType, colour = smellType)) +
  geom_density()+
  geom_vline(aes(xintercept=mean(age)), color="blue", linetype="dashed", size=1) +
  scale_x_continuous(breaks = seq(1, length(df.unique$age), 1)) +
  scale_y_continuous(breaks = pretty)
print(p)
```

##Smell overlap per version
Below we plot the overlap of each smell for every version, some jitter is added to make it easier to understand when there are multiple smells that have high overlap.
```{r}
p <- ggplot(df, aes(version, overlapRatio, group = smellType, colour = smellType)) +
  geom_point() +
  geom_jitter(width = 0.05, height = 0.05)
print(p)
```
And here is the distribution of each value per version
```{r}
p <- ggplot(df, aes(overlapRatio, group = version, colour = version)) +
  geom_density()
print(p)
```
And below the overlap per age for each smell type, again with some jitter to better allow us to distinguish each point
```{r}
p <- ggplot(df, aes(age, overlapRatio, group = smellType, colour = smellType)) +
  geom_point() +
  geom_jitter(width = 0.05, height = 0.05) +
  scale_x_continuous(breaks = seq(1, length(df.unique$age), 1)) +
  scale_y_continuous(breaks = pretty)
print(p)
```
